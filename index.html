function handleStandardInput(key) {
    const map = { 'add': '+', 'sub': '-', 'mul': '*', 'div': '/' };
    let val = map[key] || key;

    if (isFractionMode && activePart !== "outside") {
        if (activePart === "num") fractionNum += val;
        else fractionDen += val;
    } else {
        // Reset from 0 if it's the first button pressed
        if (displayString === "0") { displayString = ""; evalString = ""; }
        
        // For the Student: Add spaces around operators for readability
        displayString += (map[key] ? ` ${val} ` : val);
        
        // For the Computer: Keep it raw math (no extra spaces)
        evalString += val;
    }
}

function calculate() {
    try {
        // Clean the string: remove any spaces or special characters just in case
        let cleanExpr = isFractionMode ? `(${fractionNum || 0})/(${fractionDen || 1})` : evalString.replace(/\s/g, '');
        
        // Do the math
        let numericResult = eval(cleanExpr);
        
        // Convert to fraction for the toggle feature
        currentMathValue = new Fraction(numericResult);
        
        // Display result (prefer fraction if it's not a whole number)
        if (currentMathValue.d === 1) {
            displayString = currentMathValue.n.toString();
        } else {
            displayString = `\\frac{${currentMathValue.n}}{${currentMathValue.d}}`;
        }
        
        // Update evalString so we can do more math with the result
        evalString = numericResult.toString();
        isFractionMode = false;
        fractionNum = ""; fractionDen = "";
    } catch (e) {
        console.error("Math Error:", e);
        displayString = "\\text{Error}";
    }
}
