function calculate() {
    try {
        let res;
        if (isFractionMode) {
            // Create a fraction object from the n/d input
            res = new Fraction(fractionNum || 0, fractionDen || 1);
        } else {
            // Use fraction.js to evaluate the string to keep it as a fraction
            res = new Fraction(evalString);
        }

        // Store the result as a fraction object for the toggle button to use later
        currentMathValue = res; 

        // Display as a LaTeX fraction (e.g., \frac{3}{4})
        displayString = `\\frac{${res.n}}{${res.d}}`;
        evalString = res.toString(); // Keep decimal version in background for further math
        
        isFractionMode = false;
        fractionNum = ""; 
        fractionDen = "";
    } catch (e) {
        displayString = "\\text{Error}";
    }
}

function toggleFormat() {
    try {
        // If it's currently showing a fraction, switch to decimal
        if (displayString.includes('frac')) {
            let decimal = currentMathValue.n / currentMathValue.d;
            displayString = decimal.toString();
        } else {
            // Switch back to the fraction
            displayString = `\\frac{${currentMathValue.n}}{${currentMathValue.d}}`;
        }
    } catch (e) {
        console.log("Toggle Error:", e);
    }
}
